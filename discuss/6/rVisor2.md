## 立项依据

rVisor为一个面向小型系统（嵌入式系统、移动端、浏览器）的通用安全沙箱环境。在gVisor的基础上，提供更高层次的共享机制，并提供安全高效的跨平台解决方案。

### 安全高效的跨平台

同时支持native（ELF）和WASM两种格式，native（ELF）可以作为系统中的公用资源共WASM调用，所有平台可以有统一的native应用接口（统一以包管理形式安装应用，按需自动动态安装）。

rVisor在沙箱环境中，实现动态库 + 通用二进制文件的共享机制。（二进制文件可以考虑采用包管理的方式按需使用，节省空间）

==! 虽然理论上可以说跨平台，但最基本的系统调用可能不能跨平台，意味着需要在每个操作系统上分别实现一遍相应的功能，对我们而言不可能。另外二进制共享文件必须采用跨平台的API。==

### 内核支持（for 嵌入式）

利用rust语言擅长编写内核代码的特性，可以考虑：

![1F6BDF54A5B70C5050E828081100155D](/Users/dnailz/Course/ComputerOrganization/research1/rVisor总结.assets/1F6BDF54A5B70C5050E828081100155D.png)

#### 直接在安全环境内使用系统资源

* 直接调用系统的动态库
* 直接使用系统的二进制文件

#### 提供一个类似于LXC的系统库（理论分析）

Linux本身并没有提供对于系统调用拦截沙箱的API。

### 浏览器支持（Proposal/理论分析）

浏览器中运行传统的容器的消耗会比较大，但浏览器中需要一个可移植的运行环境。

rVisor同时支持ELF和WASM，对于运算量要求比较大的应用来说，浏览器可以为WASM提供库和可执行二进制文件，保证WASM在浏览器端的运行效率。

同时，对于浏览器来说，直接运行native不够安全，不可取，在这种微型的沙箱中运行native更可行。

但是需要浏览器内部做支持。

**浏览器代码的三层结构：native sandbox - WASM - js**

* 对效率要求最高的之间用native sandbox

* 只想要编译一次的高效率需求用 WASM

* 其他的胶水代码全部用 js
* 这三层结构正好映射了所有代码的三层结构 native代码 - 虚拟机字节码 - 脚本代码

### 移动端支持

在wasm3的基础上添加其他可用的环境。

## 比较

### gVisor

太大（仅仅go的运行时就比较大），对小型系统而言不合适。且不跨平台。比起对资源的共享而言，安全更为重要。而 rVisor 更重视资源共享，安全相比而言比较次要（用rust保证最基本的安全）。

### WASI/Emscripten

程序之间难以实现共享，对于大型系统来说可用，对小型系统来说会消耗过多的资源，且所有程序都以WASM运行代价太高。

## 工作量评估

https://github.com/google/gvisor/tree/master/pkg/sentry/syscalls/linux ： 所有Linux系统调用。


