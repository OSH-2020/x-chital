<!doctype html><html><head><meta charset=UTF-8><title>结题报告 - By dnailz</title><link rel=stylesheet href=//cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.min.css><link rel=stylesheet href=//cdn.staticfile.org/prism/1.15.0/themes/prism.min.css><link rel=stylesheet href=//cdn.staticfile.org/KaTeX/0.10.0-rc.1/katex.min.css><link href=./css/chunk-vendors.4e4765ff.css rel=stylesheet></head><body><div><article id=webslides><section slide class="slide bg-black-blue aligncenter" image="https://source.unsplash.com/C1HhAQrbykQ/ .dark"><span class="background dark" style="background-image:url('https://source.unsplash.com/C1HhAQrbykQ/')"></span><div class=wrap wrap=true><h1 class="text-landing text-shadow">结题报告</h1><p class=text-intro>By x-chital</p><p><a href=https://github.com/ksky521/nodeppt class="button ghost" target=_blank><i class="fa fa-github"></i> Github</a></p></div></section><section slide class=slide :class=size-80><div class="wrap size-80" wrap=true><div class="vertical-align grid"><div class=column><h3><strong>系统调用替换的实现</strong></h3><p class=text-intro>得到系统调用表后，编写一个简单的 C-Shim, 实现对系统调用的替换。</p><p>另外，由于 Linux 的内存保护机制，需要暂时禁止掉内存的写保护。</p></div><div class=column><pre class=language-c><code class=language-c><span class="token keyword">int</span> <span class="token function">replace_syscall</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> syscall_num<span class="token punctuation">,</span> <span class="token keyword">long</span> <span class="token punctuation">(</span><span class="token operator">*</span>syscall_fn<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

    cr0 <span class="token operator">=</span> <span class="token function">disable_wp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 关闭内存写保护</span>
    syscall_table<span class="token punctuation">[</span>syscall_num<span class="token punctuation">]</span> <span class="token operator">=</span> syscall_fn<span class="token punctuation">;</span> <span class="token comment">// 替换相应的系统调用</span>
    <span class="token function">restore_wp</span><span class="token punctuation">(</span>cr0<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 恢复内存写保护</span>
    
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></div></div></section></article></div><script src=//cdn.staticfile.org/echarts/4.1.0-release/echarts.min.js></script><script>window.pluginsOptions = {}



document.addEventListener('DOMContentLoaded', () => {
    let isPrintMode = false;
    if(~location.search.indexOf('print-pdf')){
        isPrintMode = true;
        WebSlides.registerPlugin('scroll', function(){});
    }
    const ws = new WebSlides({
        loop: false
    })
    window.wsInstance = ws;
    if(isPrintMode){
        ws.slides.forEach(s=>s.show())
    }
}, false)</script><script src=./js/chunk-vendors.js></script><script src=./js/final.js></script></body></html>