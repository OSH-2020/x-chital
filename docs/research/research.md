
# 调研报告

[TOC]

## 小组成员

* 丁垣天 dnailzb@outlook.com
* 叶之帆 yezhifan@mail.ustc.edu.cn
* 何灏迪 hardyhe@mail.ustc.edu.cn
* 郑在一

## 项目简介

rVisor 为一个基于用户空间（User Space）的通用安全沙箱环境。在gVisor的基础上， 提供更高层次的共享机制，避免 go 语言 GC 的开销，为程序提供轻量高效的运行环境。

rVisor 主要面向浏览器、移动端、嵌入式系统等对沙箱体积要求较高的小型系统，支持 Linux ELF 和 WASI 两种可执行文件，提供一个安全高效的跨平台环境。rVisor功能大体完善后也可考虑在服务端运行。

rVisor 初步可以考虑通过对Linux系统调用进行劫持的方法实现（ptrace系统调用），进一步可以考虑移植到Linux内核，作为一个Linux内核模块。rVisor 对


## 项目背景

### docker
 
#### 虚拟化技术

虚拟化（Virtualization）是一种资源管理技术，通过将计算机中的各种实体资源进行抽象后呈现。这样一来，实体结构间的障碍被打破，底层物理硬件资源可以得到充分的利用。通过这种方式，用户可以以更好的方式利用底层资源，此外也保证了更高的安全性、可用性、可扩展性。

虚拟化技术可以在不同层次上实现，如指令集层、硬件层、操作系统层、应用程序层等。

##### 指令层

指令集层次的虚拟化，即通过主机的ISA直接翻译模拟另一给定系统的ISA，其基本的模拟方式是“代码解释”，一个软件翻译层的程序将源指令逐条翻译为目标指令，一条源指令可能会对应上百条目标指令来实现相同的功能。虽然之后进行了许多优化，但其实现效率仍是各种层次的虚拟化技术中最低的。

##### 硬件层

硬件层次的虚拟化，指在硬件上直接运行Hypervisor，有利于虚拟机的操作系统直接访问硬件资源。选择使用这种解决方案的有VMware ESXi 和 Xen server。

![硬件虚拟化](https://img-blog.csdn.net/20180717140953793?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xpbnhpeWltZW5nMDA3/)

##### 操作系统层

操作系统层次的虚拟化，指在宿主机的操作系统上运行虚拟化部分，传统的虚拟化技术中，在虚拟层上仍需运行Guest OS。这种方案实现较简单，灵活性较强，但性能也相对硬件虚拟化较低。其典型例子为VMware workstation。

![操作系统虚拟化](https://img-blog.csdn.net/20180717140934421?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xpbnhpeWltZW5nMDA3/)

##### 应用程序层

应用程序层的虚拟化，是将一个应用程序虚拟化为一个虚拟机。最流行的方法是高级语言虚拟机，在这种情况下，虚拟化层作为一个应用程序处于操作系统之上，并且这一层抽象出一个虚拟机，其可以运行为特定的机器环境所编写和编译的程序。使用应用程序层次虚拟化的代表为JVM。

#### 容器技术

容器技术与传统的虚拟化技术不同，容器直接运行在操作系统内核之上的用户空间，并且在容器中不需要再包括Guest OS部分。这样的方式使得容器具有灵活、便捷的特点。在此基础上，容器也具备了虚拟化的基本特性，允许其中的应用跨平台的运行，而不用受制于Host OS的区别带来的麻烦。

#### Docker简介

![Docker](http://img.zhiding.cn/4/35/libZhTrkPc.jpg)

Docker是一个基于go语言编写的开源的应用容器引擎。通过使用Docker开发者可以打包他们的应用以及依赖包到一个可移植的容器中,然后发布到任何流行的Linux机器或Windows机器上,也可以实现虚拟化,容器是完全使用沙箱机制,相互之间不会有任何接口。

作为容器技术，Docker相比传统的虚拟化技术具有以下优点：

- 更高效的利用系统资源：由于容器不需要进行硬件虚拟以及运行完整操作系统等额外开销，Docker 对系统资源的利用率更高。无论是应用执行速度、内存损耗或者文件存储速度，都要比传统虚拟机技术更高效。因此，相比虚拟机技术，一个相同配置的主机，往往可以运行更多数量的应用。

- 更快速的启动时间：传统的虚拟机技术启动应用服务往往需要数分钟，而Docker 容器应用，由于直接运行于宿主内核，无需启动完整的操作系统，因此可以做到秒级、甚至毫秒级的启动时间。大大的节约了开发、测试、部署的时间。

- 一致的运行环境：开发过程中一个常见的问题是环境一致性问题。由于开发环境、测试环境、生产环境不一致，导致有些bug 并未在开发过程中被发现。而Docker 的镜像提供了除内核外完整的运行时环境，确保了应用运行环境一致性，从而不会再出现一段代码在不同机器上运行结果不同的问题。

- 持续交付和部署：使用Docker 可以通过定制应用镜像来实现持续集成、持续交付、部署。开发人员可以通过Dockerfile 来进行镜像构建，并结合持续集成(Continuous Integration) 系统进行集成测试，而运维人员则可以直接在生产环境中快速部署该镜像，甚至结合持续部署(Continuous Delivery/Deployment) 系统进行自动部署。

- 更轻松的迁移：Docker 使用的分层存储以及镜像的技术，使得应用重复部分的复用更为容易，也使得应用的维护更新更加简单，基于基础镜像进一步扩展镜像也变得非常简单。此外，Docker 团队同各个开源项目团队一起维护了一大批高质量的官方镜像，既可以直接在生产环境使用，又可以作为基础进一步定制，大大的降低了应用服务的镜像制作成本。使用Dockerfile 使镜像构建透明化，不仅仅开发团队可以理解应用运行环境，也方便运维团队理解应用运行所需条件，帮助更好的生产环境中部署该镜像。

#### Docker中的基本概念

##### 镜像 (Image)

镜像相当于一个特殊的文件系统，在Docker中，镜像为容器运行时提供需要的程序、库、资源、配置等文件，并会为之准备环境变量、匿名卷等配置参数。镜像不包含动态数据，在构建之后就不会被改变。
镜像，从认识上简单的来说，就是面向对象中的类，相当于一个模板。从本质上来说，镜像相当于一个文件系统。Docker 镜像是一个特殊的文件系统，除了提供容器运行时所需的程序、库、资源、配置等文件外，还包含了一些为运行时准备的一些配置参数（如匿名卷、环境变量、用户等）。镜像不包含任何动态数据，其内容在构建之后也不会被改变。

##### 容器 (Container)

容器是通过镜像创建出的实体，其本质是进程。但其运行于属于自己的命名空间，可以拥有自己的文件系统、网络配置、进程空间，甚至自己的用户ID空间。这样的特质使容器创造出一个隔离的环境，在容器内运行进程相比直接运行在Host OS上更加安全。

##### 仓库 (Repository)

仓库用于保存用户构建的镜像。镜像构建完成后，可以很容易的在当前宿主机上运行，但是，如果需要在其它服务器上使用这个镜像，我们就需要一个集中的存储、分发镜像的服务，Docker Registry 就是这样的服务。

#### Docker中的基本操作 

##### 启动与退出

启动Docker `systemctl start docker`

停止Docker `systemctl stop docker`

重启Docker `systemctl restart docker`

##### 镜像相关操作

列出所有镜像 `docker images`

搜索镜像 `docker search [IMAGE]`

拉取镜像 `docker pull [OPTIONS] NAME [:TAG]`

推送镜像 `docker push NAME [:TAG]`

创建镜像 `docker commit [OPTIONS] CONTAINER [REPOSITORY[:TAG]]`

##### 容器相关操作

启动容器 `docker run IMAGE_NAME [COMMAND] [ARG…]`

列出容器 `docker ps`

查看容器 `docker inspect name | id`

重启停止的容器 `docker start [-i] 容器名`













### Kubernetes

### gVisor

[传统容器已死，安全容器将成为云原生标配](https://zhuanlan.zhihu.com/p/99182075)

强调gVisor是一个小型Linux内核

### ptrace 系统调用


## 重要性与前瞻性分析

### 面向小型系统的通用安全沙箱环境

#### 移动端和嵌入式系统

#### 浏览器

### 服务端使用的可能性

rVisor 在移入Linux内核后，也可以考虑在服务端使用。

鉴于 Google 正在考虑将 gVisor 移入 KVM，但 gVisor 必定会受到 go 语言GC机制的局限，其性能无法得到充分的发挥。rVisor 使用在操作系统领域常用的开发语言 rust，作为这样的一个独立运行的操作系统内核更为合适。

不过考虑到本小组能力有限，rVisor在服务端的可能性可能将会无法验证。

## 相关工作

### gVisor

### WASI

### PRoot

https://github.com/proot-me/proot

## 参考文献
Docker——入门实战 https://blog.csdn.net/bskfnvjtlyzmv867/article/details/81044217
Docker安装以及原理详解 https://blog.csdn.net/linxiyimeng007/article/details/81080223
虚拟化的层次与机制 https://blog.csdn.net/mayp1/article/details/51296682
